
openapi: 3.0.0
info:
  title: Norruva DPP API
  version: v1
  description: Conceptual API endpoints for managing Digital Product Passports.
paths:
  /api/v1/dpp/{productId}:
    get:
      operationId: getDppById
      summary: Retrieve a Digital Product Passport
      description: Fetches the complete Digital Product Passport for a specific product.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      operationId: updateDpp
      summary: Update a Digital Product Passport
      description: Updates an existing Digital Product Passport. You can send partial or full updates.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the DPP to update.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDppRequestBody'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport'
        '400':
          description: Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      operationId: archiveDpp
      summary: Archive a Digital Product Passport
      description: Archives an existing Digital Product Passport by setting its status to 'archived'.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the DPP to archive.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Product with ID DPP001 has been archived successfully.
                  status:
                    type: string
                    example: Archived
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp:
    get:
      operationId: listDpps
      summary: List Digital Product Passports
      description: Retrieves a list of DPPs, with optional filtering.
      parameters:
        - name: status
          in: query
          required: false
          description: Filter by DPP status (e.g., draft, published, archived).
          schema:
            type: string
            enum: ["draft", "published", "archived", "pending_review", "revoked", "flagged", "all"]
            default: "all"
        - name: category
          in: query
          required: false
          description: Filter by product category.
          schema:
            type: string
        - name: searchQuery
          in: query
          required: false
          description: Search term for product name, ID, GTIN, or manufacturer.
          schema:
            type: string
        - name: blockchainAnchored
          in: query
          required: false
          description: Filter by blockchain anchoring status.
          schema:
            type: string
            enum: ["all", "anchored", "not_anchored"]
            default: "all"
        # Conceptual pagination parameters
        # - name: limit
        #   in: query
        #   schema:
        #     type: integer
        #     default: 20
        # - name: offset
        #   in: query
        #   schema:
        #     type: integer
        #     default: 0
      responses:
        '200':
          description: A list of Digital Product Passports.
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DigitalProductPassport' # Or a summary version
                  filtersApplied:
                    type: object
                  totalCount:
                    type: integer
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      operationId: createDpp
      summary: Create a Digital Product Passport
      description: Creates a new Digital Product Passport with the provided initial data.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDppRequestBody'
      responses:
        '201':
          description: Successful creation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport'
        '400':
          description: Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/extend/{productId}:
    patch:
      operationId: extendDpp
      summary: Extend a Digital Product Passport
      description: Allows for extending a DPP by adding document references or other modular data.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the DPP to extend.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                documentReference:
                  type: object
                  properties:
                    documentName:
                      type: string
                      description: Name of the document.
                    documentUrl:
                      type: string
                      format: url
                      description: URL to access the document.
                    documentType:
                      type: string
                      description: Type of the document (e.g., "Compliance Certificate", "Technical Manual").
                  required:
                    - documentName
                    - documentUrl
                    - documentType
                chainOfCustodyUpdate: # Conceptual - further definition needed for real use
                  type: object
                  description: "Conceptual: For updating chain of custody information."
                  properties:
                    newOwnerDid:
                      type: string
                    transferTimestamp:
                      type: string
                      format: date-time
      responses:
        '200':
          description: Successful extension
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport' # Returns the updated DPP
        '400':
          description: Invalid input data (e.g., missing documentReference).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/custody/{productId}:
    patch:
      operationId: updateCustody
      summary: Update chain of custody
      description: Appends a new custodian entry to the DPP traceability information.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the DPP to update.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                stepName:
                  type: string
                actorDid:
                  type: string
                  description: Decentralized identifier of the actor.
                timestamp:
                  type: string
                  format: date-time
                location:
                  type: string
                  nullable: true
                transactionHash:
                  type: string
                  nullable: true
              required:
                - stepName
                - actorDid
                - timestamp
      responses:
        '200':
          description: Returns the updated DPP
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport'
        '400':
          description: Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/{productId}/lifecycle-events:
    post:
      operationId: addDppLifecycleEvent
      summary: Add a Lifecycle Event to a DPP
      description: Adds a new lifecycle event to the specified Digital Product Passport.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                eventType:
                  type: string
                  description: Type of the lifecycle event (e.g., "Manufactured", "Shipped").
                  example: "Shipped"
                location:
                  type: string
                  nullable: true
                  description: Location where the event occurred.
                  example: "Warehouse B"
                details:
                  type: object
                  additionalProperties: true
                  nullable: true
                  description: Custom data related to the event.
                  example: {"orderId": "SO12345"}
                responsibleParty:
                  type: string
                  nullable: true
                  description: Party responsible for the event.
                  example: "Logistics Inc."
              required:
                - eventType
      responses:
        '201':
          description: Lifecycle event added successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LifecycleEvent'
        '400':
          description: Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/{productId}/compliance-summary:
    get:
      operationId: getDppComplianceSummary
      summary: Retrieve Compliance Summary for a DPP
      description: Fetches a summary of the compliance status for a specific product.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  productId:
                    type: string
                  productName:
                    type: string
                  overallStatus:
                    type: string
                    enum: ["Fully Compliant", "Pending Review", "Non-Compliant", "Review Needed", "N/A", "No Data"]
                  eprelStatus:
                    type: string
                    nullable: true
                  ebsiVerificationStatus:
                    type: string
                    nullable: true
                  batteryRegulationStatus:
                    type: string
                    nullable: true
                  esprStatus:
                    type: string
                    nullable: true
                  scipStatus:
                    type: string
                    nullable: true
                  customsDataStatus:
                    type: string
                    nullable: true
                  lastChecked:
                    type: string
                    format: date-time
                  details:
                    type: object
                    properties:
                      eprel:
                        type: object
                        nullable: true
                        properties:
                          id: { type: string, nullable: true }
                          status: { type: string }
                          url: { type: string, nullable: true }
                          lastChecked: { type: string, format: "date-time"}
                      ebsi:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                          verificationId: { type: string, nullable: true }
                          transactionUrl: { type: string, nullable: true }
                          lastChecked: { type: string, format: "date-time" }
                      batteryRegulation:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                      esprConformity:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                      euEspr:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                      usScope3:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                      scipNotification:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                          notificationId: { type: string, nullable: true }
                          lastChecked: { type: string, format: "date-time" }
                      euCustomsData:
                        type: object
                        nullable: true
                        properties:
                          status: { type: string }
                          declarationId: { type: string, nullable: true }
                          lastChecked: { type: string, format: "date-time" }
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/{productId}/credential:
    get:
      operationId: getDppCredential
      summary: Retrieve Verifiable Credential for a DPP
      description: Returns a verifiable credential (VC) representation of the Digital Product Passport for the specified product.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DppCredential'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/verify/{productId}:
    post:
      operationId: verifyDppById
      summary: Verify a Digital Product Passport
      description: Performs compliance and authenticity checks on a specific DPP.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product to verify.
          schema:
            type: string
      responses:
        '200':
          description: Verification result.
          content:
            application/json:
              schema:
                type: object
                properties:
                  productId:
                    type: string
                  verificationStatus:
                    type: string
                    enum: ["Verified", "VerificationFailed", "PendingFurtherChecks", "ProductNotFound"]
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  checksPerformed:
                    type: array
                    items:
                      type: string
                    example: ["Mock Data Integrity Check", "Mock EBSI Anchor Verification"]
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/anchor/{productId}:
    post:
      operationId: anchorDpp
      summary: Anchor a Digital Product Passport
      description: Creates a blockchain anchor for the specified DPP.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product to anchor.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                platform:
                  type: string
                  description: Blockchain or anchoring platform name.
              required:
                - platform
      responses:
        '200':
          description: DPP anchored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport'
        '400':
          description: Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/history/{productId}:
    get:
      operationId: getDppHistoryById
      summary: Retrieve History/Audit Trail for a DPP
      description: Fetches the history of changes and events for a specific Digital Product Passport.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HistoryEntry'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/import:
    post:
      operationId: importDpps
      summary: Batch Import Digital Product Passports
      description: Allows for batch creation or update of DPPs from an uploaded file or data payload.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fileType:
                  type: string
                  description: Type of the import file (e.g., "csv", "json").
                  example: "csv"
                data: 
                  type: string
                  description: The data to import (e.g., base64 string of file content or structured JSON data).
                  example: "UEsDBAoAAAAA..." 
                sourceDescription:
                  type: string
                  nullable: true
                  description: Optional description of the import source.
              required:
                - fileType
                - data
      responses:
        '200': 
          description: Import job acknowledged or completed.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: string
                    enum: ["PendingProcessing", "Completed", "Failed"]
                  jobId:
                    type: string
                    nullable: true
                  fileTypeReceived:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
        '400':
          description: Invalid input data (e.g., missing fileType or data).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error during import.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/import/jobs/{jobId}:
    get:
      operationId: getImportJobStatus
      summary: Retrieve Batch Import Job Status
      description: Returns the current status of a batch import job.
      parameters:
        - name: jobId
          in: path
          required: true
          description: Identifier of the import job.
          schema:
            type: string
      responses:
        '200':
          description: Current status information.
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  status:
                    type: string
                    enum: ["PendingProcessing", "Completed", "Failed"]
                  message:
                    type: string
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Job not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/graph/{productId}:
    get:
      operationId: getDppGraphData
      summary: Retrieve Graph Data for a DPP
      description: Fetches graph data (nodes and edges) for visualizing the supply chain or lifecycle related to a DPP.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DppGraphResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/status/{productId}:
    get:
      operationId: getDppStatusById
      summary: Retrieve the Status of a Digital Product Passport
      description: Fetches the current status of a specific Digital Product Passport.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DppStatusResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      '500':
        description: Internal server error.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/transfer-ownership/{productId}:
    post:
      operationId: transferDppOwnership
      summary: Transfer Ownership of a Digital Product Passport
      description: Updates ownership information for the specified DPP.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newOwner:
                  type: object
                  properties:
                    name:
                      type: string
                    did:
                      type: string
                      nullable: true
                transferTimestamp:
                  type: string
                  format: date-time
              required:
                - newOwner
                - transferTimestamp
      responses:
        '200':
          description: Ownership transferred successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalProductPassport'
        '400':
          description: Invalid input data.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/token/mint/{productId}:
    post:
      operationId: mintDppToken
      summary: Mint DPP Token
      description: Mints a blockchain token representing the specified Digital Product Passport.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MintTokenRequest'
      responses:
        '201':
          description: Token minted successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MintTokenResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/token/metadata/{tokenId}:
    patch:
      operationId: updateTokenMetadata
      summary: Update Token Metadata
      description: Updates on-chain metadata URI for a minted DPP token.
      parameters:
        - name: tokenId
          in: path
          required: true
          description: The blockchain token ID.
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTokenMetadataRequest'
      responses:
        '200':
          description: Metadata updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateTokenMetadataResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/token/status/{tokenId}:
    get:
      operationId: getTokenStatus
      summary: Retrieve Token On-Chain Status
      description: Retrieves on-chain information for a DPP token.
      parameters:
        - name: tokenId
          in: path
          required: true
          description: The blockchain token ID.
          schema:
            type: string
      responses:
        '200':
          description: On-chain status information.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenStatusResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/qr/generate/{productId}:
    get:
      operationId: generateQrCode
      summary: Generate QR Code for a Product
      description: Returns JSON containing a data URL for a PNG QR code image that links to the product's public passport.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
            example: DPP001
      responses:
        '200':
          description: JSON containing the QR code as a data URL.
          content:
            application/json:
              schema:
                type: object
                properties:
                  qrCode:
                    type: string
                    description: Data URL for a PNG image.
                    example: data:image/png;base64,iVBORw0KGgoAAA
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/qr/validate:
    post:
      operationId: validateQrCode
      summary: Validate QR Code & Retrieve DPP Summary
      description: Validates a unique identifier (typically from a QR code) and retrieves a summary of the product passport.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - qrIdentifier
              properties:
                qrIdentifier:
                  type: string
                  description: The unique identifier extracted from the QR code.
                  example: DPP001
      responses:
        '200':
          description: Successful validation
          content:
            application/json:
              schema:
                type: object
                properties:
                  productId:
                    type: string
                  productName:
                    type: string
                  category:
                    type: string
                  manufacturer:
                    type: string
                  verificationStatus:
                    type: string
                    example: valid_dpp_found
                  dppUrl:
                    type: string
                    example: /passport/DPP001
                  ebsiCompliance:
                    type: object
                    properties:
                      status:
                        type: string
                        example: verified
                      verificationId:
                        type: string
                        nullable: true
                  blockchainAnchor:
                    type: object
                    properties:
                      transactionHash:
                        type: string
                        nullable: true
                      platform:
                        type: string
                        nullable: true
        '400':
          description: Invalid request body.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: QR identifier invalid or product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/qr/{productId}:
    get:
      operationId: getQrCode
      summary: Generate QR Code for Product
      description: Returns a QR code image linking to the public passport for the specified product.
      parameters:
        - name: productId
          in: path
          required: true
          description: The unique identifier of the product.
          schema:
            type: string
      responses:
        '200':
          description: QR code image
          content:
            image/png:
              schema:
                type: string
                format: binary
        '404':
          description: Product not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/dpp/country-stats:
    get:
      operationId: getDppCountryStats
      summary: Retrieve DPP counts by country
      description: Returns the number of Digital Product Passports for each country.
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    countryCode:
                      type: string
                    count:
                      type: integer
        '401':
          description: API key missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  components:
    schemas:
      ErrorResponse:
        type: object
        properties:
          error:
            type: object
            properties:
              code:
                type: integer
              message:
                type: string
      DppStatusResponse:
        type: object
        properties:
          productId:
            type: string
            description: The unique identifier of the product.
          status:
            type: string
            description: The current status of the Digital Product Passport.
            enum: ["draft", "published", "archived", "pending_review", "revoked", "flagged"]
      DppGraphNode:
        type: object
        properties:
          id: { type: string }
          label: { type: string }
          type: { type: string, enum: ["product", "manufacturer", "supplier", "lifecycle_event", "component"] }
          data: { type: object, additionalProperties: true, nullable: true }
      DppGraphEdge:
        type: object
        properties:
          id: { type: string }
          source: { type: string, description: "ID of the source node" }
          target: { type: string, description: "ID of the target node" }
          label: { type: string, description: "Description of the relationship" }
          data: { type: object, additionalProperties: true, nullable: true }
      DppGraphResponse:
        type: object
        properties:
          nodes:
            type: array
            items:
              $ref: '#/components/schemas/DppGraphNode'
          edges:
            type: array
            items:
              $ref: '#/components/schemas/DppGraphEdge'
      DocumentReference:
        type: object
        properties:
          name:
            type: string
            description: The name of the document.
          url:
            type: string
            format: url
            description: A URL pointing to the document.
          type:
            type: string
            description: The type of document (e.g., "User Manual", "Safety Certificate").
          addedTimestamp:
            type: string
            format: date-time
            description: Timestamp when the document reference was added.
      HistoryEntry: 
        type: object
        properties:
          timestamp:
            type: string
            format: date-time
            description: Timestamp of the historical event.
          actionType:
            type: string
            description: Type of action performed (e.g., "DPP Created", "Lifecycle Event: Shipped").
          details:
            type: string
            nullable: true
            description: Additional details about the event.
          changedBy:
            type: string
            description: User or system that made the change.
          version:
            type: integer
            nullable: true
            description: Conceptual version number of the DPP after this change.
      DigitalProductPassport:
        type: object
        properties:
          id:
            type: string
          version:
            type: integer
            nullable: true
          productName:
            type: string
          category:
            type: string
          gtin:
            type: string
            nullable: true
          modelNumber:
            type: string
            nullable: true
          manufacturer:
            type: object
            nullable: true
            properties:
              name:
                type: string
              did:
                type: string
                nullable: true
              address:
                type: string
                nullable: true
              eori: # Added for EORI System conceptual integration
                type: string
                nullable: true
                description: Economic Operators Registration and Identification number.
          metadata:
            type: object
            properties:
              created_at:
                type: string
                format: date-time
                nullable: true
              last_updated:
                type: string
                format: date-time
              status:
                type: string
                enum:
                  - draft
                  - published
                  - archived
                  - pending_review
                  - revoked
                  - flagged
              dppStandardVersion:
                type: string
                nullable: true
              dataSchemaVersion:
                type: string
                nullable: true
          blockchainIdentifiers:
            type: object
            nullable: true
            properties:
              platform:
                type: string
                nullable: true
              contractAddress:
                type: string
                nullable: true
              tokenId:
                type: string
                nullable: true
              anchorTransactionHash:
                type: string
                nullable: true
          productDetails:
            type: object
            nullable: true
            properties:
              description:
                type: string
                nullable: true
              imageUrl:
                type: string
                nullable: true
              imageHint:
                type: string
                nullable: true
              materials:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    percentage:
                      type: number
                      nullable: true
                    origin:
                      type: string
                      nullable: true
                    isRecycled:
                      type: boolean
                      nullable: true
                    recycledContentPercentage:
                       type: number
                       nullable: true
              sustainabilityClaims:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    claim:
                      type: string
                    evidenceVcId:
                      type: string
                      nullable: true
                    verificationDetails:
                      type: string
                      nullable: true
              energyLabel:
                type: string
                nullable: true
              repairabilityScore:
                type: object
                nullable: true
                properties:
                  value:
                    type: number
                  scale:
                    type: number
                  reportUrl:
                    type: string
                    nullable: true
                  vcId:
                    type: string
                    nullable: true
              recyclabilityInformation:
                type: object
                nullable: true
                properties:
                  instructionsUrl:
                    type: string
                    nullable: true
                  recycledContentPercentage:
                    type: number
                    nullable: true
                  designForRecycling:
                    type: boolean
                    nullable: true
                  vcId:
                    type: string
                    nullable: true
              specifications: 
                type: string
                description: "A JSON string representing key-value technical specifications."
                example: "{\"color\": \"blue\", \"weight\": \"250g\"}"
                nullable: true
              customAttributes:
                type: array
                nullable: true
                items:
                  $ref: '#/components/schemas/CustomAttribute'
          lifecycleEvents:
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/LifecycleEvent'
          certifications:
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/Certification'
          documents: 
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/DocumentReference'
          traceability:
            $ref: '#/components/schemas/TraceabilityInfo'
            nullable: true
          compliance:
            type: object
            properties:
              eprel:
                type: object
                nullable: true
                properties:
                  id:
                    type: string
                    nullable: true
                  status:
                    type: string
                  url:
                    type: string
                    nullable: true
                  lastChecked:
                    type: string
                    format: date-time
              esprConformity:
                type: object
                nullable: true
                properties:
                  assessmentId:
                    type: string
                    nullable: true
                  status:
                    type: string
                    enum:
                      - conformant
                      - non_conformant
                      - pending_assessment
                  assessmentDate:
                    type: string
                    format: date-time
                    nullable: true
                  vcId:
                    type: string
                    nullable: true
              eu_espr:
                type: object
                nullable: true
                properties:
                  status:
                    type: string
                    enum:
                      - compliant
                      - non_compliant
                      - pending
                  reportUrl:
                    type: string
                    nullable: true
                  vcId:
                    type: string
                    nullable: true
              us_scope3:
                type: object
                nullable: true
                properties:
                  status:
                    type: string
                    enum:
                      - compliant
                      - non_compliant
                      - pending
                  reportUrl:
                    type: string
                    nullable: true
                  vcId:
                    type: string
                    nullable: true
              battery_regulation:
                type: object
                nullable: true
                properties:
                  status:
                    type: string
                    enum:
                      - compliant
                      - non_compliant
                      - pending
                      - not_applicable
                  batteryPassportId:
                    type: string
                    nullable: true
                  carbonFootprint:
                    type: object
                    nullable: true
                    properties:
                      value:
                        type: number
                      unit:
                        type: string
                      calculationMethod:
                        type: string
                        nullable: true
                      vcId:
                        type: string
                        nullable: true
                  recycledContent:
                    type: array
                    nullable: true
                    items:
                      type: object
                      properties:
                        material:
                          type: string
                        percentage:
                          type: number
                        vcId:
                          type: string
                          nullable: true
                  stateOfHealth:
                    type: object
                    nullable: true
                    properties:
                      value:
                        type: number
                      unit:
                        type: string
                      measurementDate:
                        type: string
                        format: date-time
                      vcId:
                        type: string
                        nullable: true
                  vcId:
                    type: string
                    nullable: true
              scipNotification: # Added for SCIP API conceptual integration
                type: object
                nullable: true
                properties:
                  status:
                    type: string
                    enum: ['Notified', 'Pending Notification', 'Not Required', 'Error']
                  notificationId:
                    type: string
                    nullable: true
                    description: SCIP database notification number.
                  svhcListVersion: # New
                    type: string
                    nullable: true
                    description: Version of the ECHA Candidate List used for assessment.
                  submittingLegalEntity: # New
                    type: string
                    nullable: true
                    description: Name or identifier of the legal entity that submitted the notification.
                  articleName: # New
                    type: string
                    nullable: true
                    description: Name of the article as notified to SCIP.
                  primaryArticleId: # New
                    type: string
                    nullable: true
                    description: Primary identifier of the article (e.g., EAN, TARIC code).
                  safeUseInstructionsLink: # New
                    type: string
                    format: url
                    nullable: true
                    description: Link to safe use instructions, if SVHCs are present.
                  lastChecked:
                    type: string
                    format: date-time
              euCustomsData: # Added for EU Customs Data Model conceptual integration
                type: object
                nullable: true
                properties:
                  status:
                    type: string
                    enum: ['Verified', 'Pending Documents', 'Mismatch', 'Cleared']
                  declarationId:
                    type: string
                    nullable: true
                    description: Customs declaration reference number.
                  hsCode: # New Harmonized System code
                    type: string
                    nullable: true
                    description: Harmonized System (HS) code for customs classification.
                  countryOfOrigin: # New
                    type: string
                    format: "ISO3166-1-Alpha-2"
                    nullable: true
                    description: ISO 3166-1 alpha-2 country code of origin.
                  netWeightKg: # New
                    type: number
                    format: float
                    nullable: true
                    description: Net weight of the product in kilograms.
                  grossWeightKg: # New
                    type: number
                    format: float
                    nullable: true
                    description: Gross weight of the product in kilograms.
                  customsValuation: # New
                    type: object
                    nullable: true
                    properties:
                      value:
                        type: number
                        format: float
                      currency:
                        type: string
                        format: "ISO4217" # e.g., EUR, USD
                  lastChecked:
                    type: string
                    format: date-time
          ebsiVerification:
            type: object
            nullable: true
            properties:
              status:
                type: string
                enum:
                  - verified
                  - pending_verification
                  - not_verified
                  - error
              verificationId:
                type: string
                nullable: true
              lastChecked:
                type: string
                format: date-time
              message:
                type: string
                nullable: true
              issuerDid:
                type: string
                nullable: true
                description: DID of the EBSI credential issuer.
              schema:
                type: string
                nullable: true
                description: Schema of the EBSI verifiable credential.
              issuanceDate:
                type: string
                format: date-time
                nullable: true
          verifiableCredentials:
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/VerifiableCredentialReference'
          consumerScans:
            type: integer
            nullable: true
          dataController:
            type: string
            nullable: true
          accessControlPolicyUrl:
            type: string
            format: url
            nullable: true
          privacyPolicyUrl:
            type: string
            format: url
            nullable: true
          supplyChainLinks:
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/ProductSupplyChainLink'
      LifecycleEvent:
        type: object
        properties:
          id:
            type: string
          type:
            type: string
          timestamp:
            type: string
            format: date-time
          location:
            type: string
            nullable: true
          responsibleParty:
            type: string
            nullable: true
          data:
            type: object
            additionalProperties: true
            nullable: true
          transactionHash:
            type: string
            nullable: true
          vcId:
            type: string
            nullable: true
      Certification:
        type: object
        properties:
          id:
            type: string
          name:
            type: string
          issuer:
            type: string
          issueDate:
            type: string
            format: date
          expiryDate:
            type: string
            format: date
            nullable: true
          vcId:
            type: string
            nullable: true
          documentUrl:
            type: string
            format: url
            nullable: true
          standard:
            type: string
            nullable: true
          transactionHash:
            type: string
            nullable: true
      TraceabilityInfo:
        type: object
        properties:
          batchId:
            type: string
            nullable: true
          originCountry:
            type: string
            nullable: true
          supplyChainSteps:
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/SupplyChainStep'
      SupplyChainStep:
        type: object
        properties:
          stepName:
            type: string
          actorDid:
            type: string
            nullable: true
          timestamp:
            type: string
            format: date-time
          location:
            type: string
            nullable: true
          transactionHash:
            type: string
            nullable: true
      VerifiableCredentialReference:
        type: object
        properties:
          id:
            type: string
          type:
            type: array
            items:
              type: string
          name:
            type: string
            nullable: true
          issuer:
            type: string
          issuanceDate:
            type: string
            format: date-time
          credentialSubject:
            type: object
            additionalProperties: true
          proof:
            type: object
            additionalProperties: true
            nullable: true
          verificationMethod:
            type: string
            nullable: true
      DppCredential:
        type: object
        properties:
          "@context":
            type: array
            items:
              type: string
          id:
            type: string
          type:
            type: array
            items:
              type: string
          issuer:
            type: string
          issuanceDate:
            type: string
            format: date-time
          credentialSubject:
            type: object
            additionalProperties: true
          proof:
            type: object
            additionalProperties: true
            nullable: true
      CustomAttribute:
        type: object
        properties:
          key:
            type: string
          value:
            type: string
      ProductSupplyChainLink:
        type: object
        properties:
          supplierId:
            type: string
          suppliedItem:
            type: string
          notes:
            type: string
            nullable: true
      CreateDppRequestBody:
        type: object
        required:
          - productName
          - category
        properties:
          productName:
            type: string
          category:
            type: string
          gtin:
            type: string
            nullable: true
          manufacturerName:
            type: string
            nullable: true
          modelNumber:
            type: string
            nullable: true
          productDetails:
            type: object
            nullable: true
            properties:
              description:
                type: string
                nullable: true
              materials:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    percentage:
                      type: number
                      nullable: true
                    isRecycled:
                      type: boolean
                      nullable: true
              energyLabel:
                type: string
                nullable: true
              specifications:
                type: string
                description: "A JSON string representing key-value technical specifications."
                example: "{\"color\": \"blue\"}"
                nullable: true
              customAttributes:
                type: array
                nullable: true
                items:
                  $ref: '#/components/schemas/CustomAttribute'
              imageUrl:
                type: string
                format: url
                nullable: true
              imageHint:
                type: string
                nullable: true
      UpdateDppRequestBody:
        type: object
        properties:
          productName:
            type: string
            nullable: true
          category:
            type: string
            nullable: true
          gtin:
            type: string
            nullable: true
          manufacturerName:
            type: string
            nullable: true
          modelNumber:
            type: string
            nullable: true
          metadata:
            type: object
            nullable: true
            properties:
              status:
                type: string
                enum:
                  - draft
                  - published
                  - archived
                  - pending_review
                  - revoked
                  - flagged
                nullable: true
              dppStandardVersion:
                type: string
                nullable: true
          productDetails:
            type: object
            nullable: true
            properties:
              description:
                type: string
                nullable: true
              materials:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    percentage:
                      type: number
                      nullable: true
                    isRecycled:
                      type: boolean
                      nullable: true
              sustainabilityClaims:
                type: array
                nullable: true
                items:
                  type: object
                  properties:
                    claim:
                      type: string
                    verificationDetails:
                      type: string
                      nullable: true
              energyLabel:
                type: string
                nullable: true
              specifications:
                type: string
                description: "A JSON string representing key-value technical specifications."
                nullable: true
              customAttributes:
                type: array
                nullable: true
                items:
                  $ref: '#/components/schemas/CustomAttribute'
              imageUrl:
                type: string
                format: url
                nullable: true
              imageHint:
                type: string
                nullable: true
          compliance: # Allow full update of compliance object
            type: object 
            nullable: true
            properties:
              eprel:
                type: object
                nullable: true
                properties:
                  id: { type: string, nullable: true }
                  status: { type: string, nullable: true }
                  url: { type: string, nullable: true }
                  lastChecked: { type: string, format: "date-time", nullable: true }
              esprConformity:
                type: object
                nullable: true
                properties:
                  assessmentId: { type: string, nullable: true }
                  status: { type: string, enum: ['conformant', 'non_conformant', 'pending_assessment'], nullable: true }
                  assessmentDate: { type: string, format: "date-time", nullable: true }
                  vcId: { type: string, nullable: true }
              scipNotification:
                type: object
                nullable: true
                properties:
                  status: { type: string, enum: ['Notified', 'Pending Notification', 'Not Required', 'Error'], nullable: true }
                  notificationId: { type: string, nullable: true }
                  svhcListVersion: { type: string, nullable: true }
                  submittingLegalEntity: { type: string, nullable: true }
                  articleName: { type: string, nullable: true }
                  primaryArticleId: { type: string, nullable: true }
                  safeUseInstructionsLink: { type: string, format: url, nullable: true }
                  lastChecked: { type: string, format: "date-time", nullable: true }
              euCustomsData:
                type: object
                nullable: true
                properties:
                  status: { type: string, enum: ['Verified', 'Pending Documents', 'Mismatch', 'Cleared'], nullable: true }
                  declarationId: { type: string, nullable: true }
                  hsCode: { type: string, nullable: true }
                  countryOfOrigin: { type: string, format: "ISO3166-1-Alpha-2", nullable: true }
                  netWeightKg: { type: number, format: float, nullable: true }
                  grossWeightKg: { type: number, format: float, nullable: true }
                  customsValuation: { 
                    type: object, 
                    nullable: true, 
                    properties: { value: {type: "number", format: "float"}, currency: {type: "string", format: "ISO4217"} } 
                  }
                  lastChecked: { type: string, format: "date-time", nullable: true }
              # Other compliance fields like battery_regulation, eu_espr can be included here if they need to be fully updatable
          ebsiVerification:
            type: object
            nullable: true
            properties:
              status:
                type: string
                enum:
                  - verified
                  - pending_verification
                  - not_verified
                  - error
                nullable: true
              verificationId:
                type: string
                nullable: true
              message:
                type: string
                nullable: true
          documents:
            type: array
            nullable: true
            items:
              $ref: '#/components/schemas/DocumentReference'
      MintTokenRequest:
        type: object
        required:
          - contractAddress
          - recipientAddress
        properties:
          contractAddress:
            type: string
            description: Smart contract address used for minting.
          recipientAddress:
            type: string
            description: Blockchain address receiving the token.
          metadataUri:
            type: string
            nullable: true
            description: URI for the off-chain metadata.
      MintTokenResponse:
        type: object
        properties:
          tokenId:
            type: string
          contractAddress:
            type: string
          transactionHash:
            type: string
      UpdateTokenMetadataRequest:
        type: object
        required:
          - metadataUri
        properties:
          metadataUri:
            type: string
            description: New metadata URI for the token.
          contractAddress:
            type: string
            nullable: true
            description: Contract address if different from default.
      UpdateTokenMetadataResponse:
        type: object
        properties:
          tokenId:
            type: string
          contractAddress:
            type: string
          transactionHash:
            type: string
      TokenStatusResponse:
        type: object
        properties:
          tokenId:
            type: string
          contractAddress:
            type: string
          ownerAddress:
            type: string
          mintedAt:
            type: string
            format: date-time
          metadataUri:
            type: string
            nullable: true
          lastTransactionHash:
            type: string
            nullable: true
          status:
            type: string
            description: Current on-chain status of the token.
security:
  - ApiKeyAuth: []
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: Authorization
      description: API key for authentication. Provide as 'Bearer YOUR_API_KEY'.
    

    

    





    